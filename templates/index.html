<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Voice Recorder</title>
  <script src="https://cdn.webrtc-experiment.com/RecordRTC.js"></script>
</head>
<body>
  <h2>Voice Recorder</h2>
  <button id="start">Start Recording</button>
  <button id="stop" disabled>Stop Recording</button>

  <script>
    let recorder;
    let audioStream;

    document.getElementById("start").onclick = async function() {
      audioStream = await navigator.mediaDevices.getUserMedia({ audio: true });
      recorder = RecordRTC(audioStream, {
        type: "audio",
        mimeType: "audio/wav" // you can use audio/mp3 if supported
      });
      recorder.startRecording();
      document.getElementById("start").disabled = true;
      document.getElementById("stop").disabled = false;
    };

    document.getElementById("stop").onclick = async function() {
      recorder.stopRecording(async function() {
        let blob = recorder.getBlob();
        let fileName = "recording.wav";
        let formData = new FormData();
        formData.append("audio_data", blob, fileName);

        let response = await fetch("/upload", {
          method: "POST",
          body: formData
        });

        let result = await response.json();
        console.log("Transcription Result:", result);

        audioStream.getTracks().forEach(track => track.stop());
        document.getElementById("start").disabled = false;
        document.getElementById("stop").disabled = true;
      });
    };
  </script>
</body>
</html>

